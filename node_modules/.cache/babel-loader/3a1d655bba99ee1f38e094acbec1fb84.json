{"ast":null,"code":"const toDataView = require('to-data-view');\n\nfunction makeDivisibleByFour(input) {\n  const rest = input % 4;\n  return rest ? input + 4 - rest : input;\n}\n\nclass Bitmap {\n  constructor(data, offset, {\n    width,\n    height,\n    colorDepth,\n    format\n  }) {\n    this.format = format;\n    this.offset = offset;\n    this.depth = colorDepth;\n    this.stride = makeDivisibleByFour(width * this.depth / 8);\n    this.size = this.stride * height;\n    this.data = data.slice(this.offset, this.offset + this.size);\n\n    if (this.size !== this.data.byteLength) {\n      throw new Error('Truncated bitmap data');\n    }\n  }\n\n  get(x, y, channel) {\n    const idx = this.format.indexOf(channel);\n\n    if (this.depth === 1) {\n      const slice = this.data[y * this.stride + (x / 8 | 0)];\n      const mask = 1 << 7 - x % 8 * 1;\n      return (slice & mask) >> 7 - x % 8 * 1;\n    }\n\n    if (this.depth === 2) {\n      const slice = this.data[y * this.stride + (x / 4 | 0)];\n      const mask = 3 << 6 - x % 4 * 2;\n      return (slice & mask) >>> 6 - x % 4 * 2;\n    }\n\n    if (this.depth === 4) {\n      const slice = this.data[y * this.stride + (x / 2 | 0)];\n      const mask = 15 << 4 - x % 2 * 4;\n      return (slice & mask) >>> 4 - x % 2 * 4;\n    }\n\n    return this.data[y * this.stride + x * (this.depth / 8) + idx];\n  }\n\n}\n\nfunction decodeTrueColorBmp(data, {\n  width,\n  height,\n  colorDepth,\n  icon\n}) {\n  if (colorDepth !== 32 && colorDepth !== 24) {\n    throw new Error(`A color depth of ${colorDepth} is not supported`);\n  }\n\n  const xor = new Bitmap(data, 0, {\n    width,\n    height,\n    colorDepth,\n    format: 'BGRA'\n  });\n  const and = colorDepth === 24 && icon ? new Bitmap(data, xor.offset + xor.size, {\n    width,\n    height,\n    colorDepth: 1,\n    format: 'A'\n  }) : null;\n  const result = new Uint8Array(width * height * 4);\n  let idx = 0;\n\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      result[idx++] = xor.get(x, height - y - 1, 'R');\n      result[idx++] = xor.get(x, height - y - 1, 'G');\n      result[idx++] = xor.get(x, height - y - 1, 'B');\n\n      if (colorDepth === 32) {\n        result[idx++] = xor.get(x, height - y - 1, 'A');\n      } else {\n        result[idx++] = and && and.get(x, height - y - 1, 'A') ? 0 : 255;\n      }\n    }\n  }\n\n  return result;\n}\n\nfunction decodePaletteBmp(data, {\n  width,\n  height,\n  colorDepth,\n  colorCount,\n  icon\n}) {\n  if (colorDepth !== 8 && colorDepth !== 4 && colorDepth !== 2 && colorDepth !== 1) {\n    throw new Error(`A color depth of ${colorDepth} is not supported`);\n  }\n\n  const colors = new Bitmap(data, 0, {\n    width: colorCount,\n    height: 1,\n    colorDepth: 32,\n    format: 'BGRA'\n  });\n  const xor = new Bitmap(data, colors.offset + colors.size, {\n    width,\n    height,\n    colorDepth,\n    format: 'C'\n  });\n  const and = icon ? new Bitmap(data, xor.offset + xor.size, {\n    width,\n    height,\n    colorDepth: 1,\n    format: 'A'\n  }) : null;\n  const result = new Uint8Array(width * height * 4);\n  let idx = 0;\n\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      const colorIndex = xor.get(x, height - y - 1, 'C');\n      result[idx++] = colors.get(colorIndex, 0, 'R');\n      result[idx++] = colors.get(colorIndex, 0, 'G');\n      result[idx++] = colors.get(colorIndex, 0, 'B');\n      result[idx++] = and && and.get(x, height - y - 1, 'A') ? 0 : 255;\n    }\n  }\n\n  return result;\n}\n\nfunction checkMagicBytes(bytes) {\n  if (bytes !== 0x4D42) throw new Error(`Invalid magic byte 0x${bytes.toString(16)}`);\n}\n\nmodule.exports = function decodeBmp(source, {\n  width: iconWidth = 0,\n  height: iconHeight = 0,\n  icon = false\n} = {}) {\n  const data = toDataView(source);\n  let headerSize;\n  let bitmapWidth;\n  let bitmapHeight;\n  let colorDepth;\n  let colorCount;\n\n  if (icon) {\n    headerSize = data.getUint32(0, true);\n    bitmapWidth = data.getUint32(4, true) / 1 | 0;\n    bitmapHeight = data.getUint32(8, true) / 2 | 0;\n    colorDepth = data.getUint16(14, true);\n    colorCount = data.getUint32(32, true);\n  } else {\n    checkMagicBytes(data.getUint16(0, true));\n    headerSize = 14 + data.getUint32(14, true);\n    bitmapWidth = data.getUint32(18, true);\n    bitmapHeight = data.getUint32(22, true);\n    colorDepth = data.getUint16(28, true);\n    colorCount = data.getUint32(46, true);\n  }\n\n  if (colorCount === 0 && colorDepth <= 8) {\n    colorCount = 1 << colorDepth;\n  }\n\n  const width = bitmapWidth === 0 ? iconWidth : bitmapWidth;\n  const height = bitmapHeight === 0 ? iconHeight : bitmapHeight;\n  const bitmapData = new Uint8Array(data.buffer, data.byteOffset + headerSize, data.byteLength - headerSize);\n  const result = colorCount ? decodePaletteBmp(bitmapData, {\n    width,\n    height,\n    colorDepth,\n    colorCount,\n    icon\n  }) : decodeTrueColorBmp(bitmapData, {\n    width,\n    height,\n    colorDepth,\n    icon\n  });\n  return {\n    width,\n    height,\n    data: result,\n    colorDepth\n  };\n};","map":{"version":3,"sources":["/Users/dylanott/Documents/GitHub/dylanott-website/resume-website/node_modules/decode-bmp/index.js"],"names":["toDataView","require","makeDivisibleByFour","input","rest","Bitmap","constructor","data","offset","width","height","colorDepth","format","depth","stride","size","slice","byteLength","Error","get","x","y","channel","idx","indexOf","mask","decodeTrueColorBmp","icon","xor","and","result","Uint8Array","decodePaletteBmp","colorCount","colors","colorIndex","checkMagicBytes","bytes","toString","module","exports","decodeBmp","source","iconWidth","iconHeight","headerSize","bitmapWidth","bitmapHeight","getUint32","getUint16","bitmapData","buffer","byteOffset"],"mappings":"AAAA,MAAMA,UAAU,GAAGC,OAAO,CAAC,cAAD,CAA1B;;AAEA,SAASC,mBAAT,CAA8BC,KAA9B,EAAqC;AACnC,QAAMC,IAAI,GAAGD,KAAK,GAAG,CAArB;AAEA,SAAOC,IAAI,GAAGD,KAAK,GAAG,CAAR,GAAYC,IAAf,GAAsBD,KAAjC;AACD;;AAED,MAAME,MAAN,CAAa;AACXC,EAAAA,WAAW,CAAEC,IAAF,EAAQC,MAAR,EAAgB;AAAEC,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiBC,IAAAA,UAAjB;AAA6BC,IAAAA;AAA7B,GAAhB,EAAuD;AAChE,SAAKA,MAAL,GAAcA,MAAd;AACA,SAAKJ,MAAL,GAAcA,MAAd;AACA,SAAKK,KAAL,GAAaF,UAAb;AACA,SAAKG,MAAL,GAAcZ,mBAAmB,CAACO,KAAK,GAAG,KAAKI,KAAb,GAAqB,CAAtB,CAAjC;AACA,SAAKE,IAAL,GAAa,KAAKD,MAAL,GAAcJ,MAA3B;AACA,SAAKH,IAAL,GAAYA,IAAI,CAACS,KAAL,CAAW,KAAKR,MAAhB,EAAwB,KAAKA,MAAL,GAAc,KAAKO,IAA3C,CAAZ;;AAEA,QAAI,KAAKA,IAAL,KAAc,KAAKR,IAAL,CAAUU,UAA5B,EAAwC;AACtC,YAAM,IAAIC,KAAJ,CAAU,uBAAV,CAAN;AACD;AACF;;AAEDC,EAAAA,GAAG,CAAEC,CAAF,EAAKC,CAAL,EAAQC,OAAR,EAAiB;AAClB,UAAMC,GAAG,GAAG,KAAKX,MAAL,CAAYY,OAAZ,CAAoBF,OAApB,CAAZ;;AAEA,QAAI,KAAKT,KAAL,KAAe,CAAnB,EAAsB;AACpB,YAAMG,KAAK,GAAG,KAAKT,IAAL,CAAWc,CAAC,GAAG,KAAKP,MAAV,IAAqBM,CAAC,GAAG,CAAJ,GAAQ,CAA7B,CAAV,CAAd;AACA,YAAMK,IAAI,GAAG,KAAM,IAAKL,CAAC,GAAG,CAAL,GAAU,CAAjC;AAEA,aAAO,CAACJ,KAAK,GAAGS,IAAT,KAAmB,IAAKL,CAAC,GAAG,CAAL,GAAU,CAAxC;AACD;;AAED,QAAI,KAAKP,KAAL,KAAe,CAAnB,EAAsB;AACpB,YAAMG,KAAK,GAAG,KAAKT,IAAL,CAAWc,CAAC,GAAG,KAAKP,MAAV,IAAqBM,CAAC,GAAG,CAAJ,GAAQ,CAA7B,CAAV,CAAd;AACA,YAAMK,IAAI,GAAG,KAAM,IAAKL,CAAC,GAAG,CAAL,GAAU,CAAjC;AAEA,aAAO,CAACJ,KAAK,GAAGS,IAAT,MAAoB,IAAKL,CAAC,GAAG,CAAL,GAAU,CAAzC;AACD;;AAED,QAAI,KAAKP,KAAL,KAAe,CAAnB,EAAsB;AACpB,YAAMG,KAAK,GAAG,KAAKT,IAAL,CAAWc,CAAC,GAAG,KAAKP,MAAV,IAAqBM,CAAC,GAAG,CAAJ,GAAQ,CAA7B,CAAV,CAAd;AACA,YAAMK,IAAI,GAAG,MAAO,IAAKL,CAAC,GAAG,CAAL,GAAU,CAAlC;AAEA,aAAO,CAACJ,KAAK,GAAGS,IAAT,MAAoB,IAAKL,CAAC,GAAG,CAAL,GAAU,CAAzC;AACD;;AAED,WAAO,KAAKb,IAAL,CAAWc,CAAC,GAAG,KAAKP,MAAV,GAAqBM,CAAC,IAAI,KAAKP,KAAL,GAAa,CAAjB,CAAtB,GAA6CU,GAAvD,CAAP;AACD;;AAvCU;;AA0Cb,SAASG,kBAAT,CAA6BnB,IAA7B,EAAmC;AAAEE,EAAAA,KAAF;AAASC,EAAAA,MAAT;AAAiBC,EAAAA,UAAjB;AAA6BgB,EAAAA;AAA7B,CAAnC,EAAwE;AACtE,MAAIhB,UAAU,KAAK,EAAf,IAAqBA,UAAU,KAAK,EAAxC,EAA4C;AAC1C,UAAM,IAAIO,KAAJ,CAAW,oBAAmBP,UAAW,mBAAzC,CAAN;AACD;;AAED,QAAMiB,GAAG,GAAG,IAAIvB,MAAJ,CAAWE,IAAX,EAAiB,CAAjB,EAAoB;AAAEE,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiBC,IAAAA,UAAjB;AAA6BC,IAAAA,MAAM,EAAE;AAArC,GAApB,CAAZ;AACA,QAAMiB,GAAG,GAAIlB,UAAU,KAAK,EAAf,IAAqBgB,IAAtB,GACR,IAAItB,MAAJ,CAAWE,IAAX,EAAiBqB,GAAG,CAACpB,MAAJ,GAAaoB,GAAG,CAACb,IAAlC,EAAwC;AAAEN,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiBC,IAAAA,UAAU,EAAE,CAA7B;AAAgCC,IAAAA,MAAM,EAAE;AAAxC,GAAxC,CADQ,GAER,IAFJ;AAIA,QAAMkB,MAAM,GAAG,IAAIC,UAAJ,CAAetB,KAAK,GAAGC,MAAR,GAAiB,CAAhC,CAAf;AAEA,MAAIa,GAAG,GAAG,CAAV;;AACA,OAAK,IAAIF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGX,MAApB,EAA4BW,CAAC,EAA7B,EAAiC;AAC/B,SAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGX,KAApB,EAA2BW,CAAC,EAA5B,EAAgC;AAC9BU,MAAAA,MAAM,CAACP,GAAG,EAAJ,CAAN,GAAgBK,GAAG,CAACT,GAAJ,CAAQC,CAAR,EAAWV,MAAM,GAAGW,CAAT,GAAa,CAAxB,EAA2B,GAA3B,CAAhB;AACAS,MAAAA,MAAM,CAACP,GAAG,EAAJ,CAAN,GAAgBK,GAAG,CAACT,GAAJ,CAAQC,CAAR,EAAWV,MAAM,GAAGW,CAAT,GAAa,CAAxB,EAA2B,GAA3B,CAAhB;AACAS,MAAAA,MAAM,CAACP,GAAG,EAAJ,CAAN,GAAgBK,GAAG,CAACT,GAAJ,CAAQC,CAAR,EAAWV,MAAM,GAAGW,CAAT,GAAa,CAAxB,EAA2B,GAA3B,CAAhB;;AAEA,UAAIV,UAAU,KAAK,EAAnB,EAAuB;AACrBmB,QAAAA,MAAM,CAACP,GAAG,EAAJ,CAAN,GAAgBK,GAAG,CAACT,GAAJ,CAAQC,CAAR,EAAWV,MAAM,GAAGW,CAAT,GAAa,CAAxB,EAA2B,GAA3B,CAAhB;AACD,OAFD,MAEO;AACLS,QAAAA,MAAM,CAACP,GAAG,EAAJ,CAAN,GAAgBM,GAAG,IAAIA,GAAG,CAACV,GAAJ,CAAQC,CAAR,EAAWV,MAAM,GAAGW,CAAT,GAAa,CAAxB,EAA2B,GAA3B,CAAP,GAAyC,CAAzC,GAA6C,GAA7D;AACD;AACF;AACF;;AAED,SAAOS,MAAP;AACD;;AAED,SAASE,gBAAT,CAA2BzB,IAA3B,EAAiC;AAAEE,EAAAA,KAAF;AAASC,EAAAA,MAAT;AAAiBC,EAAAA,UAAjB;AAA6BsB,EAAAA,UAA7B;AAAyCN,EAAAA;AAAzC,CAAjC,EAAkF;AAChF,MAAIhB,UAAU,KAAK,CAAf,IAAoBA,UAAU,KAAK,CAAnC,IAAwCA,UAAU,KAAK,CAAvD,IAA4DA,UAAU,KAAK,CAA/E,EAAkF;AAChF,UAAM,IAAIO,KAAJ,CAAW,oBAAmBP,UAAW,mBAAzC,CAAN;AACD;;AAED,QAAMuB,MAAM,GAAG,IAAI7B,MAAJ,CAAWE,IAAX,EAAiB,CAAjB,EAAoB;AAAEE,IAAAA,KAAK,EAAEwB,UAAT;AAAqBvB,IAAAA,MAAM,EAAE,CAA7B;AAAgCC,IAAAA,UAAU,EAAE,EAA5C;AAAgDC,IAAAA,MAAM,EAAE;AAAxD,GAApB,CAAf;AACA,QAAMgB,GAAG,GAAG,IAAIvB,MAAJ,CAAWE,IAAX,EAAiB2B,MAAM,CAAC1B,MAAP,GAAgB0B,MAAM,CAACnB,IAAxC,EAA8C;AAAEN,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiBC,IAAAA,UAAjB;AAA6BC,IAAAA,MAAM,EAAE;AAArC,GAA9C,CAAZ;AACA,QAAMiB,GAAG,GAAGF,IAAI,GAAG,IAAItB,MAAJ,CAAWE,IAAX,EAAiBqB,GAAG,CAACpB,MAAJ,GAAaoB,GAAG,CAACb,IAAlC,EAAwC;AAAEN,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiBC,IAAAA,UAAU,EAAE,CAA7B;AAAgCC,IAAAA,MAAM,EAAE;AAAxC,GAAxC,CAAH,GAA4F,IAA5G;AAEA,QAAMkB,MAAM,GAAG,IAAIC,UAAJ,CAAetB,KAAK,GAAGC,MAAR,GAAiB,CAAhC,CAAf;AAEA,MAAIa,GAAG,GAAG,CAAV;;AACA,OAAK,IAAIF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGX,MAApB,EAA4BW,CAAC,EAA7B,EAAiC;AAC/B,SAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGX,KAApB,EAA2BW,CAAC,EAA5B,EAAgC;AAC9B,YAAMe,UAAU,GAAGP,GAAG,CAACT,GAAJ,CAAQC,CAAR,EAAWV,MAAM,GAAGW,CAAT,GAAa,CAAxB,EAA2B,GAA3B,CAAnB;AAEAS,MAAAA,MAAM,CAACP,GAAG,EAAJ,CAAN,GAAgBW,MAAM,CAACf,GAAP,CAAWgB,UAAX,EAAuB,CAAvB,EAA0B,GAA1B,CAAhB;AACAL,MAAAA,MAAM,CAACP,GAAG,EAAJ,CAAN,GAAgBW,MAAM,CAACf,GAAP,CAAWgB,UAAX,EAAuB,CAAvB,EAA0B,GAA1B,CAAhB;AACAL,MAAAA,MAAM,CAACP,GAAG,EAAJ,CAAN,GAAgBW,MAAM,CAACf,GAAP,CAAWgB,UAAX,EAAuB,CAAvB,EAA0B,GAA1B,CAAhB;AACAL,MAAAA,MAAM,CAACP,GAAG,EAAJ,CAAN,GAAgBM,GAAG,IAAIA,GAAG,CAACV,GAAJ,CAAQC,CAAR,EAAWV,MAAM,GAAGW,CAAT,GAAa,CAAxB,EAA2B,GAA3B,CAAP,GAAyC,CAAzC,GAA6C,GAA7D;AACD;AACF;;AAED,SAAOS,MAAP;AACD;;AAED,SAASM,eAAT,CAA0BC,KAA1B,EAAiC;AAC/B,MAAIA,KAAK,KAAK,MAAd,EAAsB,MAAM,IAAInB,KAAJ,CAAW,wBAAuBmB,KAAK,CAACC,QAAN,CAAe,EAAf,CAAmB,EAArD,CAAN;AACvB;;AAEDC,MAAM,CAACC,OAAP,GAAiB,SAASC,SAAT,CAAoBC,MAApB,EAA4B;AAAEjC,EAAAA,KAAK,EAAEkC,SAAS,GAAG,CAArB;AAAwBjC,EAAAA,MAAM,EAAEkC,UAAU,GAAG,CAA7C;AAAgDjB,EAAAA,IAAI,GAAG;AAAvD,IAAiE,EAA7F,EAAiG;AAChH,QAAMpB,IAAI,GAAGP,UAAU,CAAC0C,MAAD,CAAvB;AAEA,MAAIG,UAAJ;AACA,MAAIC,WAAJ;AACA,MAAIC,YAAJ;AACA,MAAIpC,UAAJ;AACA,MAAIsB,UAAJ;;AAEA,MAAIN,IAAJ,EAAU;AACRkB,IAAAA,UAAU,GAAGtC,IAAI,CAACyC,SAAL,CAAe,CAAf,EAAkB,IAAlB,CAAb;AACAF,IAAAA,WAAW,GAAIvC,IAAI,CAACyC,SAAL,CAAe,CAAf,EAAkB,IAAlB,IAA0B,CAA3B,GAAgC,CAA9C;AACAD,IAAAA,YAAY,GAAIxC,IAAI,CAACyC,SAAL,CAAe,CAAf,EAAkB,IAAlB,IAA0B,CAA3B,GAAgC,CAA/C;AACArC,IAAAA,UAAU,GAAGJ,IAAI,CAAC0C,SAAL,CAAe,EAAf,EAAmB,IAAnB,CAAb;AACAhB,IAAAA,UAAU,GAAG1B,IAAI,CAACyC,SAAL,CAAe,EAAf,EAAmB,IAAnB,CAAb;AACD,GAND,MAMO;AACLZ,IAAAA,eAAe,CAAC7B,IAAI,CAAC0C,SAAL,CAAe,CAAf,EAAkB,IAAlB,CAAD,CAAf;AACAJ,IAAAA,UAAU,GAAG,KAAKtC,IAAI,CAACyC,SAAL,CAAe,EAAf,EAAmB,IAAnB,CAAlB;AACAF,IAAAA,WAAW,GAAGvC,IAAI,CAACyC,SAAL,CAAe,EAAf,EAAmB,IAAnB,CAAd;AACAD,IAAAA,YAAY,GAAGxC,IAAI,CAACyC,SAAL,CAAe,EAAf,EAAmB,IAAnB,CAAf;AACArC,IAAAA,UAAU,GAAGJ,IAAI,CAAC0C,SAAL,CAAe,EAAf,EAAmB,IAAnB,CAAb;AACAhB,IAAAA,UAAU,GAAG1B,IAAI,CAACyC,SAAL,CAAe,EAAf,EAAmB,IAAnB,CAAb;AACD;;AAED,MAAIf,UAAU,KAAK,CAAf,IAAoBtB,UAAU,IAAI,CAAtC,EAAyC;AACvCsB,IAAAA,UAAU,GAAI,KAAKtB,UAAnB;AACD;;AAED,QAAMF,KAAK,GAAIqC,WAAW,KAAK,CAAhB,GAAoBH,SAApB,GAAgCG,WAA/C;AACA,QAAMpC,MAAM,GAAIqC,YAAY,KAAK,CAAjB,GAAqBH,UAArB,GAAkCG,YAAlD;AAEA,QAAMG,UAAU,GAAG,IAAInB,UAAJ,CAAexB,IAAI,CAAC4C,MAApB,EAA4B5C,IAAI,CAAC6C,UAAL,GAAkBP,UAA9C,EAA0DtC,IAAI,CAACU,UAAL,GAAkB4B,UAA5E,CAAnB;AAEA,QAAMf,MAAM,GAAGG,UAAU,GACrBD,gBAAgB,CAACkB,UAAD,EAAa;AAAEzC,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiBC,IAAAA,UAAjB;AAA6BsB,IAAAA,UAA7B;AAAyCN,IAAAA;AAAzC,GAAb,CADK,GAErBD,kBAAkB,CAACwB,UAAD,EAAa;AAAEzC,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiBC,IAAAA,UAAjB;AAA6BgB,IAAAA;AAA7B,GAAb,CAFtB;AAIA,SAAO;AAAElB,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiBH,IAAAA,IAAI,EAAEuB,MAAvB;AAA+BnB,IAAAA;AAA/B,GAAP;AACD,CAtCD","sourcesContent":["const toDataView = require('to-data-view')\n\nfunction makeDivisibleByFour (input) {\n  const rest = input % 4\n\n  return rest ? input + 4 - rest : input\n}\n\nclass Bitmap {\n  constructor (data, offset, { width, height, colorDepth, format }) {\n    this.format = format\n    this.offset = offset\n    this.depth = colorDepth\n    this.stride = makeDivisibleByFour(width * this.depth / 8)\n    this.size = (this.stride * height)\n    this.data = data.slice(this.offset, this.offset + this.size)\n\n    if (this.size !== this.data.byteLength) {\n      throw new Error('Truncated bitmap data')\n    }\n  }\n\n  get (x, y, channel) {\n    const idx = this.format.indexOf(channel)\n\n    if (this.depth === 1) {\n      const slice = this.data[(y * this.stride) + (x / 8 | 0)]\n      const mask = 1 << (7 - (x % 8) * 1)\n\n      return (slice & mask) >> (7 - (x % 8) * 1)\n    }\n\n    if (this.depth === 2) {\n      const slice = this.data[(y * this.stride) + (x / 4 | 0)]\n      const mask = 3 << (6 - (x % 4) * 2)\n\n      return (slice & mask) >>> (6 - (x % 4) * 2)\n    }\n\n    if (this.depth === 4) {\n      const slice = this.data[(y * this.stride) + (x / 2 | 0)]\n      const mask = 15 << (4 - (x % 2) * 4)\n\n      return (slice & mask) >>> (4 - (x % 2) * 4)\n    }\n\n    return this.data[(y * this.stride) + (x * (this.depth / 8)) + idx]\n  }\n}\n\nfunction decodeTrueColorBmp (data, { width, height, colorDepth, icon }) {\n  if (colorDepth !== 32 && colorDepth !== 24) {\n    throw new Error(`A color depth of ${colorDepth} is not supported`)\n  }\n\n  const xor = new Bitmap(data, 0, { width, height, colorDepth, format: 'BGRA' })\n  const and = (colorDepth === 24 && icon)\n    ? new Bitmap(data, xor.offset + xor.size, { width, height, colorDepth: 1, format: 'A' })\n    : null\n\n  const result = new Uint8Array(width * height * 4)\n\n  let idx = 0\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      result[idx++] = xor.get(x, height - y - 1, 'R')\n      result[idx++] = xor.get(x, height - y - 1, 'G')\n      result[idx++] = xor.get(x, height - y - 1, 'B')\n\n      if (colorDepth === 32) {\n        result[idx++] = xor.get(x, height - y - 1, 'A')\n      } else {\n        result[idx++] = and && and.get(x, height - y - 1, 'A') ? 0 : 255\n      }\n    }\n  }\n\n  return result\n}\n\nfunction decodePaletteBmp (data, { width, height, colorDepth, colorCount, icon }) {\n  if (colorDepth !== 8 && colorDepth !== 4 && colorDepth !== 2 && colorDepth !== 1) {\n    throw new Error(`A color depth of ${colorDepth} is not supported`)\n  }\n\n  const colors = new Bitmap(data, 0, { width: colorCount, height: 1, colorDepth: 32, format: 'BGRA' })\n  const xor = new Bitmap(data, colors.offset + colors.size, { width, height, colorDepth, format: 'C' })\n  const and = icon ? new Bitmap(data, xor.offset + xor.size, { width, height, colorDepth: 1, format: 'A' }) : null\n\n  const result = new Uint8Array(width * height * 4)\n\n  let idx = 0\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      const colorIndex = xor.get(x, height - y - 1, 'C')\n\n      result[idx++] = colors.get(colorIndex, 0, 'R')\n      result[idx++] = colors.get(colorIndex, 0, 'G')\n      result[idx++] = colors.get(colorIndex, 0, 'B')\n      result[idx++] = and && and.get(x, height - y - 1, 'A') ? 0 : 255\n    }\n  }\n\n  return result\n}\n\nfunction checkMagicBytes (bytes) {\n  if (bytes !== 0x4D42) throw new Error(`Invalid magic byte 0x${bytes.toString(16)}`)\n}\n\nmodule.exports = function decodeBmp (source, { width: iconWidth = 0, height: iconHeight = 0, icon = false } = {}) {\n  const data = toDataView(source)\n\n  let headerSize\n  let bitmapWidth\n  let bitmapHeight\n  let colorDepth\n  let colorCount\n\n  if (icon) {\n    headerSize = data.getUint32(0, true)\n    bitmapWidth = (data.getUint32(4, true) / 1) | 0\n    bitmapHeight = (data.getUint32(8, true) / 2) | 0\n    colorDepth = data.getUint16(14, true)\n    colorCount = data.getUint32(32, true)\n  } else {\n    checkMagicBytes(data.getUint16(0, true))\n    headerSize = 14 + data.getUint32(14, true)\n    bitmapWidth = data.getUint32(18, true)\n    bitmapHeight = data.getUint32(22, true)\n    colorDepth = data.getUint16(28, true)\n    colorCount = data.getUint32(46, true)\n  }\n\n  if (colorCount === 0 && colorDepth <= 8) {\n    colorCount = (1 << colorDepth)\n  }\n\n  const width = (bitmapWidth === 0 ? iconWidth : bitmapWidth)\n  const height = (bitmapHeight === 0 ? iconHeight : bitmapHeight)\n\n  const bitmapData = new Uint8Array(data.buffer, data.byteOffset + headerSize, data.byteLength - headerSize)\n\n  const result = colorCount\n    ? decodePaletteBmp(bitmapData, { width, height, colorDepth, colorCount, icon })\n    : decodeTrueColorBmp(bitmapData, { width, height, colorDepth, icon })\n\n  return { width, height, data: result, colorDepth }\n}\n"]},"metadata":{},"sourceType":"script"}